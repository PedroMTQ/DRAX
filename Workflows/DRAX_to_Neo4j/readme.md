# Running the DRAX_to_Neo4j workflow



## Required installation

This workflow requires [Neo4j graph database](https://neo4j.com/product/neo4j-graph-database/), either the [enterprise](https://neo4j.com/download-center/#enterprise) or [community](https://neo4j.com/download-center/#community) edition.
The community edition is more limited, however, it will fit within the scope of this workflow, i.e., exporting DRAX's data to Neo4j.

Since only one database can be created per Neo4j community edition instance, this workflow always deletes previous databases in the Neo4j database instance.

To run Neo4j in DRAX do the following:

1. Go to the url provided above for enterprise or community editions
2. Download your specific OS version and follow the instructions
3. Go to your Neo4j folder and run  `./bin/neo4j console`. Now your Neo4j database should be running in the background.
4. Install the Neo4j driver in your environment with `conda install -c conda-forge neo4j-python-driver`
5. Go to http://localhost:7474/browser/ and set up your database (basically, set a username and password)
6. run the workflow with `python GSMM_Expansion.py -i drax_input.tsv -o output_folder -db kegg,rhea,biocyc,hmdb -username <neo4j_username> --password <neo4j_password>`

You can now execute the workflow!



## Executing workflow

To execute this workflow simply do `python GSMM_Expansion.py -i drax_input.tsv -o output_folder -db kegg,rhea,biocyc,hmdb -username <neo4j_username> --password <neo4j_password>`

The `input_folder` variable should be a folder with one or more protein sequences fastas.
The `output_folder` will be the directory where this workflow outputs its analysis. This folder contains the following folders and files:
- `models` - CarveMe models, built by running CarveMe on the fastas
- `mantis_input.tsv` - tsv with fastas path to be used in Mantis
- `mantis_output` - Mantis annotations, generated by functionally annotated the fastas
- `drax_input` - DRAX's input tsv, containing the annotations from Mantis minus the annotations already in the CarveMe models
- `drax_output` - DRAX's output, i.e., data gathered on compounds,reactions, and proteins, as well as the corresponding graph in `.sif` format
- `workflow_output` - the expanded networks in `.sif` format, each network has 4 columns, `SOURCE`,`INTERACTION`,`TARGET`, and`EXPANSION`. The `SOURCE` and `TARGET` nodes can either be the IDs from the original network or the `internal_id`s from DRAX. The `INTERACTION` column describes the type of connection (either `cr` for a `compound->reaction` edge or `rc` for `reaction->compound` edge). The `EXPANSION` column marks (1/0) whether the current edge came from the original CarveMe model (`0`), or if it was added during the expansion (`1`). **The network expansion only add edges if they are somehow connected to the original network**.
- `console.out` - console output

The variable `database` can be used to choose which database you want to collect data from. By default, all the databases are used (i.e., kegg,rhea,biocyc,hmdb).

You can additionally add `-nc` or `--non_connected` when running this workflow. Without `-nc` the resulting `.sif` networks will only contain the additional edges that connect to compounds in the original network; if including `-nc` all edges are added.
