# Running the GSMM_Expansion workflow


## Required installation

To run this workflow you need to install CarveMe. Unfortunately, this can't be handled automatically since you need to download CPLEX manually.
Regardless, please follow the instructions found [here](https://carveme.readthedocs.io/en/latest/installation.html) to install CarveMe.

**Please make sure you create a conda environment for CarveME, and name it `carveme_env`**
This is important because the workflow will run CarveMe automatically, and to do so, it needs to find the correct environment.

Please also make sure that when you install drax, you leave the environment with the default name: `drax_env`

You need `networkx` to run this analysis; to install it run `conda install -c anaconda networkx` 

## Executing workflow

To execute this workflow simply do `python GSMM_Expansion.py -i input_folder -o output_folder -db kegg,rhea,biocyc,hmdb`

The `input_folder` variable should be a folder with one or more protein sequences fastas. 
The `output_folder` will be the directory where this workflow outputs its analysis. This folder contains the following folders and files:
- `models` - CarveMe models, built by running CarveMe on the fastas
- `mantis_input.tsv` - tsv with fastas path to be used in Mantis
- `mantis_output` - Mantis annotations, generated by functionally annotated the fastas
- `drax_input` - DRAX's input tsv, containing the annotations from Mantis minus the annotations already in the CarveMe models
- `drax_output` - DRAX's output, i.e., data gathered on compounds,reactions, and proteins, as well as the corresponding graph in `.sif` format 
- `workflow_output` - the expanded networks in `.sif` format, each network has 4 columns, `SOURCE`,`INTERACTION`,`TARGET`, and`EXPANSION`. The `SOURCE` and `TARGET` nodes can either be the IDs from the original network or the `internal_id`s from DRAX. The `INTERACTION` column describes the type of connection (either `cr` for a `compound->reaction` edge or `rc` for `reaction->compound` edge). The `EXPANSION` column marks (1/0) whether the current edge came from the original CarveMe model (`0`), or if it was added during the expansion (`1`). **The network expansion only add edges if they are somehow connected to the original network**.
- `console.out` - console output

The variable `database` can be used to choose which database you want to collect data from. By default, all the databases are used (i.e., kegg,rhea,biocyc,hmdb).

You can additionally add `-nc` or `--non_connected` when running this workflow. Without `-nc` the resulting `.sif` networks will only contain the additional edges that connect to compounds in the original network; if including `-nc` all edges are added.